dim(embed.coords.periph) <- c(num.periph.vec,embed.dim)
#dimorder ()<- c(2,1)  is necessary, because
#the matrix is stored in row-major order as opposed to the standard R
# assumption of column-major order.
dimorder(embed.coords.periph) <- c(2,1)
embed.coords.periph.ffdf <- ffdf( v.name=ff_periph_v_vector ,x=embed.coords.periph)
ffsave.image("lender.embed.ff")
write.csv.ffdf(lender.embed.core.ff,file="kiva.embed.lenders.csv")
write.csv.ffdf(embed.coords.periph.ffdf,file="kiva.embed.lenders.csv"
,append=TRUE
)
rownames(lender.embed.core.ff)
rownames(lender.embed.core.ff) <- (core.v.chunk)
rownames(lender.embed.core.ff) <- (core.v.chunk)
colnames(lender.embed.core.ff)<- c(paste("x.",1:embed.dim,sep=""))
write.csv.ffdf(lender.embed.core.ff,file="kiva.embed.lenders.csv")
write.csv.ffdf(embed.coords.periph.ffdf,file="kiva.embed.lenders.csv"
,append=TRUE
)
?ffdfappend
?ddply
source('~/projects/XDATA/AdjMatEmbed/R/preprocess.R')
csv.dir<-"F:\Users\Sancar\Documents\projects\XDATA\akamai_merged"
csv.dir<-"~/XDATA/akamai_merged"
csv.dir<-"~/XDATA/akamai_merged/test_dir"
setwd(csv.dir)
fnames<-dir()
getwd()
csv.dir
csv.dir<-"~/projects/XDATA/akamai_merged/test_dir"
setwd(csv.dir)
fnames<-dir()
fnames
ffdf.edgelist.read <- NULL
line.count<-10000
filename<- fnames[[1]]
file.conn <- gzfile(description=filename,open="r")
read.chunk <- character(0)
length(read.chunk)
read.chunk <- character(0)
read.chunk
read.chunk <- "a"
read.chunk <- readLines(con=file.conn
,n=line.count,ok=TRUE)
traceback()
traceback()
?readLines
line.count
read.chunk <- readLines(con=file.conn
,n=line.count,ok=FALSE)
read.chunk <- readLines(con=file.conn
,n=line.count,ok=TRUE)
read.chunk <- readLines(con=file.conn
,n=10,ok=TRUE)
head(read.chunk)
read.chunk <- readLines(con=file.conn
,n=line.count,ok=TRUE)
data.frame.read <- data.frame(
traceNum = rep(as.integer(0)
, line.count)
, vp   = rep(as.integer(0),line.count)
, time = rep(as.integer(0),line.count)
, hop  = rep(as.integer(0),line.count)
, delay= rep(as.numeric(0),line.count)
, IP   = rep("",line.count)
, country = rep("",line.count)
, AS   = rep("",line.count)
, lat  = rep("",line.count)
, lon  = rep("",line.count)
)
line.i <- 1
split.lines <- strsplit(read.chunk,split='\t')
for (line in split.lines){
line<-as.list(line)
line[1:4]  <- lapply( line[1:4], FUN=as.numeric)
line[[5]]  <-  as.numeric(line[[5]])
line[6:10] <- lapply( line[6:10], FUN=as.character)
data.frame.read[line.i,] <-line
line.i <- line.i + 1
}
head(line[[5]] )
str(line)
str(split.lines)
split.lines <- strsplit(read.chunk,split=',')
for (line in split.lines){
line<-as.list(line)
line[1:4]  <- lapply( line[1:4], FUN=as.numeric)
line[[5]]  <-  as.numeric(line[[5]])
line[6:10] <- lapply( line[6:10], FUN=as.character)
data.frame.read[line.i,] <-line
line.i <- line.i + 1
}
warnings()
for (line in split.lines){
line<-as.list(line)
numeric.vars <- c(1:4,8:10)
line[numeric.vars]  <- lapply( line[numeric.vars]
, FUN=as.numeric)
#line[[5]]  <-  as.numeric(line[[5]])
line[[6]]  <- as.character( line[[6]])
line[[7]]  <- as.factor(    line[[7]])
data.frame.read[line.i,] <-line
line.i <- line.i + 1
}
}
# lapply (split.lines)
for (line in split.lines){
line<-as.list(line)
numeric.vars <- c(1:4,8:10)
line[numeric.vars]  <- lapply( line[numeric.vars]
, FUN=as.numeric)
#line[[5]]  <-  as.numeric(line[[5]])
line[[6]]  <- as.character( line[[6]])
line[[7]]  <- as.factor(    line[[7]])
data.frame.read[line.i,] <-line
line.i <- line.i + 1
}
split.lines.df <- Reduce(split.lines,rbind)
?Reduce
split.lines.df <- Reduce(x=split.lines,f=rbind)
str( split.lines.df)
?aggregate
split.lines <- strsplit(read.chunk,split=',')
# lapply (split.lines)
for (line in split.lines){
line<-as.list(line)
numeric.vars <- c(1:4,8:10)
line[numeric.vars]  <- lapply( line[numeric.vars]
, FUN=as.numeric)
#line[[5]]  <-  as.numeric(line[[5]])
line[[6]]  <- as.character( line[[6]])
line[[7]]  <- as.factor(    line[[7]])
data.frame.read[line.i,] <-line
line.i <- line.i + 1
}
read.table
?read.table
?readLines
t.read<-read.table(file.conn)
t.read<- read.table(file.conn,nrows=line.count,sep=",",colClasses=
c("integer","integer","integer","integer",
"numeric","character","character","numeric",
"numeric","numeric")
)
t.read<- read.csv(file.conn,nrows=line.count,sep=","
,colClasses=
c("integer","integer","integer","integer",
"numeric","character","character","numeric",
"numeric","numeric"))
read.chunk[[1]]
t.read<- read.csv(file.conn,nrows=line.count,sep=","
,colClasses=
c("integer","integer","integer","integer",
"numeric","character","character","numeric",
"numeric","numeric"),fill=TRUE)
t.read<- read.csv(file.conn,nrows=line.count,sep=","
,colClasses=
c("integer","integer","integer","integer",
"numeric","character","character","character",
"character","character"),fill=TRUE)
t.read<- read.csv(file.conn,nrows=line.count,sep=","
,colClasses=
c("integer","integer","integer","integer",
"numeric","character","character","character",
"numeric","numeric"),fill=TRUE)
line.ptr<-0
data.frame.read <- read.csv(file.conn, nrows=line.count
, col.names = c(
"traceNum", "vp","time","hop"
, "delay", "IP"  , "country"
, "AS" , "lat", "lon" )
,colClasses=
c("integer","integer","integer"
,"integer","numeric","character"
,"character","character",
"numeric","numeric"),fill=TRUE
,sep=",", stringsAsFactors=FALSE
,skip=line.ptr)
data.frame.read[,1]
table()data.frame.read$hop
table(data.frame.read$hop)
?which
?which.max
?which
data.fram.read[,1:2]
data.frame.read[,1:2]
data.frame.read[1:2,]
data.frame.read[1:4,]
data.frame.read[1:5,]
data.frame.read[1:10,]
rm(file.conn)
file.conn <- gzfile(description=filename,open="r")
data.frame.read <- read.csv(file.conn, nrows=line.count
, col.names = c(
"traceNum", "vp","time","hop"
, "delay", "IP"  , "country"
, "AS" , "lat", "lon" )
,colClasses=
c("integer","integer","integer"
,"integer","numeric","character"
,"character","character",
"numeric","numeric"),fill=TRUE
,sep=",", stringsAsFactors=FALSE
,skip=line.ptr)
data.frame.read[,1]
data.frame.read[1,]
data.frame.read[1:5,]
data.frame.read <- read.csv(file.conn, nrows=line.count
, col.names = c(
"traceNum", "vp","time","hop"
, "delay", "IP"  , "country"
, "AS" , "lat", "lon" )
,colClasses=
c("integer","integer","integer"
,"integer","numeric","character"
,"character","character",
"numeric","numeric"),fill=TRUE
,sep=",", stringsAsFactors=FALSE
,skip=line.ptr)
data.frame.read[1:5,]
remains.of.prev.traceroute <-    data.frame(
traceNum = rep(as.integer(0) , line.count)
, vp   = rep(as.integer(0),line.count)
, time = rep(as.integer(0),line.count)
, hop  = rep(as.integer(0),line.count)
, delay= rep(as.numeric(0),line.count)
, IP   = rep("",line.count)
, country = rep("",line.count)
, AS   = rep("",line.count)
, lat  = rep("",line.count)
, lon  = rep("",line.count)
)
?data.frame
as.data.frame
remains.of.prev.traceroute <-    data.frame(
traceNum = integer(0)
, vp   = integer(0)
, time = integer(0)
, hop  = integer(0)
, delay= numeric(0)
, IP   = ""
, country = ""
, AS   = ""
, lat  = numeric(0)
, lon  = numeric(0)
)
remains.of.prev.traceroute <-    data.frame(
traceNum = integer(0)
, vp   = integer(0)
, time = integer(0)
, hop  = integer(0)
, delay= numeric(0)
, IP   = character(0)
, country = character(0)
, AS   = character(0)
, lat  = numeric(0)
, lon  = numeric(0)
)
remains.of.prev.traceroute
data.frame.read <- rbind(remains.of.prev.traceroute
,data.frame.read)
#find beginning of last traceroute in read chunk
line.ptr <- tail(which(data.frame.read$hop==0),1)
remains.of.prev.traceroute <- data.frame.read[line.ptr:line.count,]
nrow(data.frame.read)
remains.of.prev.traceroute
data.frame.read<- data.frame.read[-line.ptr:line.count,]
data.frame.read<- data.frame.read[-(line.ptr:line.count),]
nrow(data.frame.read)
filter.row.var <- (data.frame.read$hop>0  &
data.frame.read$hop < n.first.hops) &
(data.frame.read$vp == vant.pt)
n.first.hops <- 7
filter.row.var <- (data.frame.read$hop>0  &
data.frame.read$hop <= n.first.hops) &
(data.frame.read$vp == vant.pt)
filter.col.var <- c(1,6,3,5) # traceNum, IP, time, delay
table(data.frame.read$vt)
table(data.frame.read$vt.pt)
table(data.frame.read$vp)
vant.pt <- 4149
filter.col.var <- c(1,6,3,5) # traceNum, IP, time, delay
data.frame.read <- data.frame.read[filter.row.var,][,filter.col.var]
filter.row.var <- (data.frame.read$hop>0  &
data.frame.read$hop <= n.first.hops) &
(data.frame.read$vp %in% vant.pt)
filter.col.var <- c(1,6,3,5) # traceNum, IP, time, delay
data.frame.read <- data.frame.read[filter.row.var,][,filter.col.var]
dim*(data.frame.read)
dim(data.frame.read)
hops2edges <- function(hoplist,vant.pt){
num.hops<- nrow(hoplist)
num.edges <- (num.hops-1)
#num.attribs <- 2  #ncol(hoplist) - 2
edge.list <- data.frame(v1=rep(NA,num.edges),
v2=rep(NA,num.edges),
time=rep("",num.edges),
delay= rep(NA,num.edges))
edge.list[,2:4] <- hoplist[,2:4]
edge.list[1,]<- c(vant.pt,hoplist[1:(num.edges-1),2])
}
edgelist.with.attribs <- ddply(   .data=data.frame.read
,  .variables=traceNum
,  .fun=hops2edges,vant.pt)
names(data.frame.read)
edgelist.with.attribs <- ddply(   .data=data.frame.read
,  .variables="traceNum"
,  .fun=hops2edges,vant.pt)
warnings()
hops2edges <- function(hoplist,vant.pt){
num.hops<- nrow(hoplist)
num.edges <- (num.hops)
#num.attribs <- 2  #ncol(hoplist) - 2
edge.list <- data.frame(v1=rep(NA,num.edges),
v2=rep(NA,num.edges),
time=rep("",num.edges),
delay= rep(NA,num.edges))
edge.list[,2:4] <- hoplist[,2:4]
edge.list[1,]<- c(vant.pt,hoplist[1:(num.edges-1),2])
}
edgelist.with.attribs <- ddply(   .data=data.frame.read
,  .variables="traceNum"
,  .fun=hops2edges,vant.pt)
warnings()
hops2edges <- function(hoplist,vant.pt){
num.hops<- nrow(hoplist)
num.edges <- (num.hops)
#num.attribs <- 2  #ncol(hoplist) - 2
edge.list <- data.frame(v1=rep(NA,num.edges),
v2=rep(NA,num.edges),
time=rep("",num.edges),
delay= rep(NA,num.edges))
edge.list[,2:4] <- hoplist[,2:4]
edge.list[,1]<- c(vant.pt,hoplist[1:(num.edges-1),2])
}
edgelist.with.attribs <- ddply(   .data=data.frame.read
,  .variables="traceNum"
,  .fun=hops2edges,vant.pt)
head(edgelist.with.attribs)
edgelist.with.attribs$v1
?ddply
hops2edges <- function(hoplist,vant.pt){
num.hops<- nrow(hoplist)
num.edges <- (num.hops)
#num.attribs <- 2  #ncol(hoplist) - 2
edge.list <- data.frame(v1=rep(NA,num.edges),
v2=rep(NA,num.edges),
time=rep("",num.edges),
delay= rep(NA,num.edges))
edge.list[,2:4] <- hoplist[,2:4]
edge.list[,1]<- c(vant.pt,hoplist[1:(num.edges-1),2])
return(edge.list)
}
hops2edges <- function(hoplist,vant.pt){
num.hops<- nrow(hoplist)
num.edges <- (num.hops)
#num.attribs <- 2  #ncol(hoplist) - 2
edge.list <- data.frame(v1=rep(NA,num.edges),
v2=rep(NA,num.edges),
time=rep("",num.edges),
delay= rep(NA,num.edges))
edge.list[,2:4] <- hoplist[,2:4]
edge.list[,1]<- c(vant.pt,hoplist[1:(num.edges-1),2])
return(edge.list)
}
edgelist.with.attribs <- ddply(   .data=data.frame.read
,  .variables="traceNum"
,  .fun=hops2edges,vant.pt)
head(edgelist.with.attribs)
head(edgelist.with.attribs,n=20)
file.conn <- gzfile(description=filename,open="r")
# read.chunk <- "a"
continue.file.read <-TRUE
line.ptr<-0
remains.of.prev.traceroute <-    data.frame(
traceNum = integer(0) ,    vp     = integer(0)
,  time   = integer(0) ,    hop    = integer(0)
,  delay  = numeric(0) ,    IP     = character(0)
,  country = character(0) , AS     = character(0)
,  lat  = numeric(0)      , lon    = numeric(0)
)
while (continue.file.read){
data.frame.read <- read.csv(file.conn, nrows=line.count
, col.names = c(
"traceNum", "vp","time","hop"
, "delay", "IP"  , "country"
, "AS" , "lat", "lon" )
,colClasses=
c("integer","integer","integer"
,"integer", "numeric" ,"character"
,"character" ,"character"
,"numeric" ,"numeric")
,fill=TRUE
,sep=",", stringsAsFactors=FALSE
)
file.conn <- gzfile(description=filename,open="r")
# read.chunk <- "a"
continue.file.read <-TRUE
line.ptr<-0
remains.of.prev.traceroute <-    data.frame(
traceNum = integer(0) ,    vp     = integer(0)
,  time   = integer(0) ,    hop    = integer(0)
,  delay  = numeric(0) ,    IP     = character(0)
,  country = character(0) , AS     = character(0)
,  lat  = numeric(0)      , lon    = numeric(0)
)
data.frame.read <- read.csv(file.conn, nrows=line.count
, col.names = c(
"traceNum", "vp","time","hop"
, "delay", "IP"  , "country"
, "AS" , "lat", "lon" )
,colClasses=
c("integer","integer","integer"
,"integer", "numeric" ,"character"
,"character" ,"character"
,"numeric" ,"numeric")
,fill=TRUE
,sep=",", stringsAsFactors=FALSE
)
if (nrow(data.frame.read)==0)
continue.file.read<-FALSE
data.frame.read <- rbind(remains.of.prev.traceroute
,data.frame.read)
#find beginning of last traceroute in read chunk
line.ptr <- tail(which(data.frame.read$hop==0),1)
remains.of.prev.traceroute <- data.frame.read[line.ptr:line.count,]
data.frame.read<- data.frame.read[-(line.ptr:line.count),]
#filter to get only the first n.first.hops and
#only those vantage point
filter.row.var <- (data.frame.read$hop>0  &
data.frame.read$hop <= n.first.hops) &
(data.frame.read$vp %in% vant.pt)
filter.col.var <- c(1,6,3,5) # traceNum, IP, time, delay
data.frame.read <- data.frame.read[filter.row.var,][,filter.col.var]
edgelist.with.attribs <- ddply(.data=data.frame.read
,  .variables="traceNum"
,  .fun=hops2edges,vant.pt)
#ffdf.read <- ffdfappend (ffdf.read, data.frame.read)
ffdf.edgelist.read <- ffdfappend (ffdf.edgelist.read , edgelist.with.attribs )
str( ffdf.edgelist.read)
data.frame.read <- read.csv(file.conn, nrows=line.count
, col.names = c(
"traceNum", "vp","time","hop"
, "delay", "IP"  , "country"
, "AS" , "lat", "lon" )
,colClasses=
c("integer","integer","integer"
,"integer", "numeric" ,"character"
,"character" ,"character"
,"numeric" ,"numeric")
,fill=TRUE
,sep=",", stringsAsFactors=FALSE
)
if (nrow(data.frame.read)==0)
continue.file.read<-FALSE
data.frame.read <- rbind(remains.of.prev.traceroute
,data.frame.read)
#find beginning of last traceroute in read chunk
line.ptr <- tail(which(data.frame.read$hop==0),1)
remains.of.prev.traceroute <- data.frame.read[line.ptr:line.count,]
#remove the possible portion of traceroute
data.frame.read<- data.frame.read[-(line.ptr:line.count),]
#filter to get only the first n.first.hops and
#only those vantage point
filter.row.var <- (data.frame.read$hop>0  &
data.frame.read$hop <= n.first.hops) &
(data.frame.read$vp %in% vant.pt)
filter.col.var <- c(1,6,3,5) # traceNum, IP, time, delay
data.frame.read <- data.frame.read[filter.row.var,][,filter.col.var]
edgelist.with.attribs <- ddply(.data=data.frame.read
,  .variables="traceNum"
,  .fun=hops2edges,vant.pt)
#ffdf.read <- ffdfappend (ffdf.read, data.frame.read)
ffdf.edgelist.read <- ffdfappend (ffdf.edgelist.read , edgelist.with.attribs )
}
dim(ffdf.edgelist.read )
data.frame.read <- read.csv(file.conn, nrows=line.count
, col.names = c(
"traceNum", "vp","time","hop"
, "delay", "IP"  , "country"
, "AS" , "lat", "lon" )
,colClasses=
c("integer","integer","integer"
,"integer", "numeric" ,"character"
,"character" ,"character"
,"numeric" ,"numeric")
,fill=TRUE
,sep=",", stringsAsFactors=FALSE
)
if (nrow(data.frame.read)==0)
continue.file.read<-FALSE
data.frame.read <- rbind(remains.of.prev.traceroute
,data.frame.read)
#find beginning of last traceroute in read chunk
line.ptr <- tail(which(data.frame.read$hop==0),1)
remains.of.prev.traceroute <- data.frame.read[line.ptr:line.count,]
#remove the possible portion of traceroute
data.frame.read<- data.frame.read[-(line.ptr:line.count),]
#filter to get only the first n.first.hops and
#only those vantage point
filter.row.var <- (data.frame.read$hop>0  &
data.frame.read$hop <= n.first.hops) &
(data.frame.read$vp %in% vant.pt)
filter.col.var <- c(1,6,3,5) # traceNum, IP, time, delay
data.frame.read <- data.frame.read[filter.row.var,][,filter.col.var]
edgelist.with.attribs <- ddply(.data=data.frame.read
,  .variables="traceNum"
,  .fun=hops2edges,vant.pt)
#ffdf.read <- ffdfappend (ffdf.read, data.frame.read)
ffdf.edgelist.read <- ffdfappend (ffdf.edgelist.read , edgelist.with.attribs )
}
dim(ffdf.edgelist.read )
